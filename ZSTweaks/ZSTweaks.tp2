BACKUP "weidu_external/backup/ZSTweaks"
AUTHOR "RoyalProtector at Gibberlings's forum https://www.gibberlings3.net/profile/12720-royalprotector/"
VERSION "v1.0"
README ~ZSTweaks/README.md~
AUTO_EVAL_STRINGS
/////////////////////////////////////////////////////////////////////////////////////////////////////
ALWAYS
    INCLUDE ~ZSTweaks/libs/zs_tw_functions.tpa~
END
/////////////////////////////////////////////////////////////////////////////////////////////////////
LANGUAGE
"English"
"english"
"ZSTweaks/lang/english/setup.tra"

////////////////// GENERAL WEAPON TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\
//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @120 DESIGNATED 120 GROUP @10 // MAGIC WEAPONS APR
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_magicwpn_apr.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1120 DESIGNATED 1120 GROUP @10 // BACKSTAB PENALTIES
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/zs_correct_animations.tph~

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_SHORT 0x1c wpn_cat
    READ_BYTE  0x31 wpn_prof
    READ_ASCII 0x22 wpn_appearance (2)

	PATCH_IF wpn_cat == 20  AND (wpn_prof == 90 OR wpn_prof == 94 OR (wpn_prof == 95 AND "%wpn_appearance%" STRING_COMPARE_CASE "sc" = 0)) BEGIN // long swords, katanas or scimitars
        LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=263,p1=-1~ END
    END
    PATCH_IF wpn_cat == 26  AND wpn_prof == 102 BEGIN // quarterstaves
        LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=263,p1=-2~ END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1121 DESIGNATED 1121 GROUP @10 // FLAILS/MORNINGSTARS TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_SHORT 0x1c wpn_cat
    READ_BYTE  0x31 wpn_prof
    READ_ASCII 0x22 wpn_appearance (2)
    READ_LONG 0x60 ench

	PATCH_IF (wpn_cat = 22 OR wpn_cat = 23) AND wpn_prof = 100 BEGIN
        SET piercing = (16 << 16)
        PATCH_IF ench = 0 OR ench = 1 BEGIN
            LPF a7_auto_apply_spl_effect
                STR_VAR
                    function_name = ~ADD_ITEM_EFFECT~
                    effect_codes = ~t=1,op=12,tgt=2,tmg=1,p1=1,p2=%piercing%~
            END
        END
        PATCH_IF ench = 2 OR ench = 3 BEGIN
            LPF a7_auto_apply_spl_effect
                STR_VAR
                    function_name = ~ADD_ITEM_EFFECT~
                    effect_codes = ~t=1,op=12,tgt=2,tmg=1,p1=2,p2=%piercing%~
            END
        END
        PATCH_IF ench = 4 OR ench = 5 BEGIN
            LPF a7_auto_apply_spl_effect
                STR_VAR
                    function_name = ~ADD_ITEM_EFFECT~
                    effect_codes = ~t=1,op=12,tgt=2,tmg=1,p1=3,p2=%piercing%~
            END
        END
        PATCH_IF ench = 6 BEGIN
            LPF a7_auto_apply_spl_effect
                STR_VAR
                    function_name = ~ADD_ITEM_EFFECT~
                    effect_codes = ~t=1,op=12,tgt=2,tmg=1,p1=4,p2=%piercing%~
            END
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1150 DESIGNATED 1150 GROUP @10 // SPEARS BASE DMG IMPROVEMENT
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_SHORT 0x1c wpn_cat
    READ_BYTE  0x31 wpn_prof

    PATCH_IF wpn_cat == 29  AND wpn_prof == 98 BEGIN
        LPF ALTER_HEADER
            INT_VAR
                match_type = 1
                match_dicesize = 6
                match_dicenumber = 1
                dicesize = 8
                silent = 1
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1160 DESIGNATED 1160 GROUP @10 // WARHAMMERS BASE DMG IMPROVEMENT
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_SHORT 0x1c wpn_cat
    READ_BYTE  0x31 wpn_prof

    PATCH_IF wpn_cat == 21  AND wpn_prof == 97 BEGIN // warhammers
        LPF ALTER_HEADER
            INT_VAR
                match_type = 1
                match_dicesize = 4
                match_dicenumber = 1
                dicesize = 5
                silent = 1
        END
    END
BUT_ONLY

ACTION_IF FILE_EXISTS_IN_GAME "bdhamm02.itm" BEGIN
    COPY_EXISTING "bdhamm02.itm" ~override~ // voidhammer +3
        LPF ALTER_EFFECT
            INT_VAR
                match_opcode = 12
                dicesize = 5
        END
    BUT_ONLY
END

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1350 DESIGNATED 1350 GROUP @10 // WAKIZASHI/NINJATO DMG/SPEED
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/zs_correct_animations.tph~

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_BYTE  0x31 wpn_prof
    READ_ASCII 0x22 wpn_appearance (2)

	PATCH_IF wpn_prof = 95 AND ("%wpn_appearance%" STRING_COMPARE_CASE "ss" = 0 OR "%wpn_appearance%" STRING_COMPARE_CASE "s1" = 0) BEGIN // wakizashis and ninjatos
        LPF ALTER_HEADER
            INT_VAR
                silent = 1
                match_type = 1
                match_dicesize = 8
                match_dicenumber = 1
                dicenumber = 2
                dicesize = 4
        END

        FOR ( current_sp = 4; current_sp > 0; --current_sp ) BEGIN // decrease ninja-tos speed by 1
            LPF ALTER_HEADER
                INT_VAR
                    silent = 1
                    match_type = 1
                    match_speed = current_sp
                    speed = current_sp - 1
            END
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1351 DESIGNATED 1352 GROUP @10 // WAKIZASHIS PIERCING/SLASHING
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/zs_correct_animations.tph~

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_BYTE  0x31 wpn_prof
    READ_ASCII 0x22 wpn_appearance (2)

	PATCH_IF wpn_prof = 95 AND "%wpn_appearance%" STRING_COMPARE_CASE "ss" = 0 BEGIN // wakizashis
        LPF ALTER_HEADER
            INT_VAR
                silent = 1
                match_type = 1
                damage_type = 7 // piercing or slashing
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1360 DESIGNATED 1360 GROUP @10 // LIGHT CROSSBOW +1/2 APR BONUS
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~xbow04.itm~ ~override~
	READ_LONG 0x08 light_xbow_strref
BUT_ONLY

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_SHORT 0x1c wpn_cat
    READ_BYTE  0x31 wpn_prof
    READ_SHORT 0x26 min_str
    READ_LONG 0x08 name_strref

    PATCH_IF wpn_cat = 27  AND wpn_prof = 103 AND (name_strref = %light_xbow_strref% OR min_str <= 8) BEGIN // light crossbows
        LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=1,p1=6,p2=0~ END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1370 DESIGNATED 1370 GROUP @10 // KATANAS DAMAGE
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_SHORT 0x1c wpn_cat
    READ_BYTE  0x31 wpn_prof
    READ_SHORT 0x26 min_str

    PATCH_IF wpn_cat = 20  AND wpn_prof = 94 BEGIN // katanas
        LPF ALTER_HEADER
            STR_VAR
                match_type = 1
                match_dicesize = 10
                match_dicenumber = 1
                dicesize = 5
                dicenumber = 2
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1400 DESIGNATED 1400 GROUP @10 // BASTARD SWORDS DMG
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_SHORT 0x1c wpn_cat
    READ_BYTE  0x31 wpn_prof

	PATCH_IF wpn_cat == 20  AND wpn_prof == 89 BEGIN // bastard swords
        LPF ALTER_HEADER
            INT_VAR
                silent = 1
                match_type = 1
                match_dicesize = 4
                match_dicenumber = 2
                dicenumber = 1
                dicesize = 8
        END
        FOR ( current_dmg = 6; current_dmg >= 0; current_dmg -= 1 ) BEGIN
            LPF ALTER_HEADER
                INT_VAR
                    silent = 1
                    match_type = 1
                    match_damage = current_dmg
                    damage = current_dmg + 1
            END
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1430 DESIGNATED 1430 GROUP @10 // TWO HANDED SWORD DICE CHANGES
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    READ_SHORT 0x1c wpn_cat
    READ_BYTE  0x31 wpn_prof

    PATCH_IF wpn_cat = 20  AND wpn_prof = 93 BEGIN // two-handed swords
        LPF ALTER_HEADER
            STR_VAR
                silent = 1
                match_type = 1
                match_dicesize = 12
                match_dicenumber = 1
                dicenumber = 2
                dicesize = 6
        END
        FOR ( current_dmg = 6; current_dmg >= 0; current_dmg -= 1 ) BEGIN
            LPF ALTER_HEADER
                INT_VAR
                    silent = 1
                    match_type = 1
                    match_dicesize = 10
                    match_dicenumber = 1
                    match_damage = current_dmg
                    dicesize = 9
                    damage = current_dmg + 1
            END
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1440 DESIGNATED 1440 GROUP @10 // DAGGER BONUSES
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_dagger_plus.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1450 DESIGNATED 1450 GROUP @10 // ROGUE WPN BONUSES
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_rogue_wpns.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1530 DESIGNATED 1530 GROUP @10
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP "DAGG1[12]\.ITM" ~override~
    LPF ALTER_HEADER
        INT_VAR
            dicenumber = 1
    END
    PATCH_IF MOD_IS_INSTALLED "ZSTweaks.tp2" "1435" BEGIN
        FOR ( current_dmg = 6; current_dmg >= 0; current_dmg -= 1 ) BEGIN
            LPF ALTER_HEADER
                INT_VAR
                    silent = 1
                    match_type = 1
                    match_dicesize = 4
                    match_dicenumber = 1
                    match_damage = current_dmg
                    dicesize = 3
                    damage = current_dmg + 1
            END
        END
    END
BUT_ONLY

////////////////// ARMOR/GEAR TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1170 DESIGNATED 1170 GROUP @11 // SHADOW DRAGON ARMOR TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~LEAT19.ITM~ ~override~
    LPF DELETE_EFFECT INT_VAR check_headers = 0 match_opcode = 27 END
    LPF DELETE_EFFECT INT_VAR check_headers = 0 match_opcode = 142 END
    LPF ADD_EQUIPPED_EFF STR_VAR effects =~op=69;op=169,p2=59;op=169,p2=53;op=142,p2=90;op=101,p2=216;op=282,p1=1,p2=2;op=267,p1=41495;op=267,p1=40968;op=267,p1=40969;op=267,p1=40979;op=267,p1=41616;op=346,p1=4~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1171 DESIGNATED 1171 GROUP @11 // SILVER DRAGON ARMOR TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~ohdarmor.ITM~ ~override~
    SAY IDENTIFIED_DESC @6770
    LPF ADD_EQUIPPED_EFF STR_VAR effects =~op=28,p1=40~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1172 DESIGNATED 1172 GROUP @11 // RINGS OF ELEMENTAL CONTROL
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ~RING2[7-9].ITM~ ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 177
            match_savebonus = 2
            savebonus = "-2"
    END
BUT_ONLY

COPY_EXISTING ~RING27.ITM~ ~override~
    SAY IDENTIFIED_DESC @6740
BUT_ONLY

COPY_EXISTING ~RING28.ITM~ ~override~
    SAY IDENTIFIED_DESC @6750
    LPF ADD_EQUIPPED_EFF STR_VAR effects =~op=29,p1=50~ END
BUT_ONLY

COPY_EXISTING ~RING29.ITM~ ~override~
    SAY IDENTIFIED_DESC @6760
    LPF ADD_EQUIPPED_EFF STR_VAR effect_codes =~op=27,p1=50~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1173 DESIGNATED 1173 GROUP @11 // RING OF GAXX
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~RING39.ITM~ ~override~
    SAY IDENTIFIED_DESC @6780
    LPF ALTER_EFFECT
        INT_VAR
            match_duration = 10
            duration = 12
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1174 DESIGNATED 1174 GROUP @11 // HEARTWOOD RING DRUID
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~RING44.ITM~ ~override~
    SAY IDENTIFIED_DESC @6790
    LPF ALTER_EFFECT
        INT_VAR
            check_headers = 0
            match_opcode = 62
            parameter1 = 127 // one per level
    END
    LPF DELETE_EFFECT
        INT_VAR
            check_headers = 0
            match_opcode = 62
            multi_match = 1
    END
    LPF ADD_EQUIPPED_EFF STR_VAR effects =~op=98,p1=6,p2=3~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1180 DESIGNATED 1180 GROUP @11 // RINGER OF DANGER SENSE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet bgee" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~RING36.ITM~ ~override~
    SAY IDENTIFIED_DESC @6030
    LPF ADD_EQUIPPED_EFF STR_VAR effect_codes =~op=292,p2=1~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1316 DESIGNATED 1316 GROUP @11 // MERCYKILLER RING TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY
    ~ZSTweaks/eff/ZSTWTHM1.EFF~ override
    ~ZSTweaks/eff/ZSTWTHM2.EFF~ override
    ~ZSTweaks/eff/ZSTWTHM3.EFF~ override

COPY_EXISTING ~WA2RING.ITM~ ~override~
    WRITE_LONG 0x1e 1611987392 // allows rangers to use it
    SAY IDENTIFIED_DESC @6340
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 4 p2 = 5 STR_VAR effects = ~op=177,res=ZSTWTHM1;op=177,res=ZSTWTHM2;op=177,res=ZSTWTHM3~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1317 DESIGNATED 1317 GROUP @11 // BASIC ROBES BUFF
REQUIRE_PREDICATE GAME_IS "bg2ee bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_basic_robes.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1560 DESIGNATED 1560 GROUP @11 // ADD PIERCING TO BELT OF THE BLADE
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "bdbelt02.ITM" ~override~
    SAY IDENTIFIED_DESC @6510
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=332,p1=10,p2=8~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1561 DESIGNATED 1561 GROUP @11 // cloak of the star more darts
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "CLCK25.ITM" ~override~
    SAY IDENTIFIED_DESC @6820
    LPF ALTER_EFFECT
        INT_VAR
            check_globals = 0
            match_opcode = 255
            parameter1 = 30
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1570 DESIGNATED 1570 GROUP @11 // EYES OF THE BEHOLDER TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "ohreyeb.ITM" ~override~
    SAY IDENTIFIED_DESC @6520
BUT_ONLY

COPY_EXISTING "ohreyeb1.SPL" ~override~
    LPF ALTER_EFFECT
        INT_VAR
            check_globals = 0
            header_type = 1
            match_savingthrow = 1
            savebonus = "-2"
    END
BUT_ONLY

COPY_EXISTING "ohreyeb2.SPL" ~override~
    LPF ALTER_EFFECT
        INT_VAR
            check_globals = 0
            header_type = 1
            match_savingthrow = 1
            savebonus = "-1"
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1610 DESIGNATED 1610 GROUP @11 // ROBE OF INVOCATION TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "ohnrobe2.ITM" ~override~
    SAY IDENTIFIED_DESC @6530
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 5 STR_VAR effects = ~op=332,p2=1;op=332,p2=2;op=332,p2=3;op=332,p2=4;op=346,p1=2,spec=6~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1620 DESIGNATED 1620 GROUP @11 // THAYAN CIRCLET TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "ohnhelm1.ITM" ~override~
    SAY IDENTIFIED_DESC @6460
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_globals = 1
            match_opcode = 281
            parameter1 = 25
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1650 DESIGNATED 1650 GROUP @11 // ROBE APPEARANCE TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ".*\.itm" ~override~
    PATCH_IF (SHORT_AT 0x1c) = 2 BEGIN // armor
        READ_ASCII 0x22 armor_appearance (2)
        PATCH_IF "%armor_appearance%" STRING_COMPARE_CASE "2w" = 0 BEGIN // apperance of simple robes
            WRITE_ASCII 0x22 "3W" #2
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1651 DESIGNATED 1651 GROUP @11 // STUDDED LEATHER OF THORNS PIERCING EXTRA
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "LEAT23.ITM" ~override~
    SAY IDENTIFIED_DESC @6890
BUT_ONLY

COPY_EXISTING "LEAT23A.SPL" ~override~
    SET piercing = (16 << 16)
    LPF CLONE_EFFECT
        INT_VAR
            match_opcode = 12
            parameter2 = piercing
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1652 DESIGNATED 1652 GROUP @11 // GRANDMASTER ARMOR
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "LEAT24.ITM" ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 126
            opcode = 176
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1653 DESIGNATED 1653 GROUP @11 // THIEVES HOOD TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "HELM29.ITM" ~override~
    SAY UNIDENTIFIED_DESC @6911
    WRITE_LONG 0x18 (THIS - 2**25) // protects against critical hits now
BUT_ONLY

COPY_EXISTING "HELM30.ITM" ~override~
    SAY IDENTIFIED_DESC @6910
    WRITE_LONG 0x18 (THIS - 2**25) // protects against critical hits now
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 4 p2 = 5 STR_VAR effects = ~op=177,res=ZSTWTVH1;op=177,res=ZSTWTVH2~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1654 DESIGNATED 1654 GROUP @11 // STAR STREWN TWEAKS
REQUIRE_PREDICATE GAME_IS "bgee eet" @50
//////////////////////////////////////////////////////////////////////////////////////////////////////

ACTION_IF FILE_EXISTS_IN_GAME "bdboot03.itm" BEGIN
    COPY_EXISTING "bdboot03.itm" ~override~
        SAY IDENTIFIED_DESC @6920
        LPF ALTER_EFFECT INT_VAR match_opcode = 166 parameter1 = 10 END
        LPF CLONE_EFFECT INT_VAR match_opcode = 177 parameter1 = IDS_OF_SYMBOL(kit INQUISITOR) END
    BUT_ONLY
END

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1655 DESIGNATED 1655 GROUP @11 // CROWN OF LIES TWEAK
REQUIRE_PREDICATE GAME_IS "bgee eet" @50
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "bdhelm01.itm" ~override~
    SAY IDENTIFIED_DESC @6960
    LPF DELETE_EFFECT INT_VAR check_headers = 0 match_opcode = 21 END
    LPF ADD_EQUIPPED_EFF STR_VAR effect_codes = ~op=21,p1=-15;op=49,p1=-2~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1656 DESIGNATED 1656 GROUP @11 // HELM OF DUMATHOIN TWEAK
REQUIRE_PREDICATE GAME_IS "bgee eet" @50
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "bdhelm09.itm" ~override~
    SAY IDENTIFIED_DESC @6970
    LPF ALTER_EFFECT
        INT_VAR
            check_headers = 0
            match_parameter1 = 3
            match_parameter2 = 0
            parameter1 = 5
    END
BUT_ONLY


//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1657 DESIGNATED 1657 GROUP @11 // THE VISAGE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "ohdmask.itm" ~override~
    SAY IDENTIFIED_DESC @7030
    LPF ADD_ITEM_HEADER
        INT_VAR
            copy_header = 2
    END
    LPF ALTER_EFFECT
        INT_VAR
            header_type = 3
            header = 2
            match_opcode = 146
        STR_VAR
            match_resource = ~SPWI506~
            resource = ~SPCL103~
    END
BUT_ONLY

COPY_EXISTING "ohdmask.spl" ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            dicenumber = 8
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1658 DESIGNATED 1658 GROUP @11 // DRAGON HELM TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~HELM21.itm~ ~override~
    SAY IDENTIFIED_DESC @7040
    LPF CLONE_EFFECT
        INT_VAR
            match_opcode = 29
            opcode = 27
    END
    LPF CLONE_EFFECT
        INT_VAR
            match_opcode = 29
            opcode = 36
            parameter1 = 2
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1659 DESIGNATED 1659 GROUP @11 // HELM OF THE ROCK TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ~HELM3[12]\.itm~ ~override~
    LPF CLONE_EFFECT
        INT_VAR
            match_opcode = 29
            opcode = 31
    END
    PATCH_IF "%SOURCE_RES%" STRING_COMPARE_CASE "HELM31" = 0 BEGIN
        SAY IDENTIFIED_DESC @7050
    END ELSE BEGIN
        SAY IDENTIFIED_DESC @7051
        FOR ( new_opcode = 86; new_opcode <= 89; ++new_opcode ) BEGIN
            LPF CLONE_EFFECT
                INT_VAR
                    match_opcode = 29
                    opcode = new_opcode
                    parameter1 = 7
            END
        END
        LPF CLONE_EFFECT
            INT_VAR
                match_opcode = 29
                opcode = 6
                parameter1 = 1
        END
        LPF ALTER_ITEM_HEADER
            INT_VAR
                header_type = 3
                projectile = IDS_OF_SYMBOL(projectl SPKLARIC)

        END
    END
BUT_ONLY

////////////////// DAGGER TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\
//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1000 DESIGNATED 1000 GROUP @12 // POISONED THROWING DAGGERS
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "DAGG16.itm" ~override~
    SAY UNIDENTIFIED_DESC @6380
    LPF ALTER_EFFECT
        INT_VAR
            check_headers = 1
            header_type = 2
            match_opcode = 25
            savebonus = "-2"
    END
    LPF ALTER_EFFECT
        INT_VAR
            check_headers = 1
            header_type = 2
            match_opcode = 142
            savebonus = "-2"
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1130 DESIGNATED 1130 GROUP @12 // BONE BLADE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY "%MOD_FOLDER%/eff/ZSTW_DG6.EFF" ~override~

COPY_EXISTING ~DAGG14.ITM~ ~override~
    SAY IDENTIFIED_DESC @6000
    LPF ADD_ITEM_EFFECT
        INT_VAR
            type = 1
            timing = 1
            opcode = 12
            target = 2
            dicesize  = 4
            dicenumber = 1
    END
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_headers = 1
            match_opcode = 12
            parameter2 = (1 << 16)
    END
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=27,p1=40~ END
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_target = 2
            def_parameter2 = 4
            def_timing = 1
        STR_VAR
            def_resource = ~ZSTW_DG6~
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~t=1,op=177,p1=2;t=1,op=177,p1=123;t=1,op=177,p1=172;t=1,op=177,p1=138;t=1,op=177,p1=167;t=1,op=177,p1=135;t=1,op=177,p1=124~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1140 DESIGNATED 1140 GROUP @12 // DAGGER OF THE STAR TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_daggerstar.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1490 DESIGNATED 1490 GROUP @12 // NEB'S DAGGER
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "NEBDAG.ITM" ~override~
    SAY IDENTIFIED_DESC @6230
    WRITE_ASCII 0x10 ~~ #8
    LPF ALTER_HEADER
        INT_VAR
            type = 1
            charges = 0
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1630 DESIGNATED 1630 GROUP @12 // JADE FANG BOOST
REQUIRE_PREDICATE GAME_IS "bg2ee eet" "This mod was written for BG2EE and EET"
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_jade_fang.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1660 DESIGNATED 1660 GROUP @12 // DAGGER OF THE GOLEM
REQUIRE_PREDICATE GAME_IS "bg2ee bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "dagg03.ITM" ~override~
    SAY IDENTIFIED_DESC @6590
    LPF ADD_EQUIPPED_EFF STR_VAR effect_codes = ~op=166,p1=10~ END
    SET magic_dmg = (64 << 16)
    LPF a7_auto_apply_spl_effect
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~t=1,tgt=2,tmg=1,op=12,dsize=4,dnum=1,pro1=49,p2=%magic_dmg%~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1670 DESIGNATED 1670 GROUP @12 // WEREBANE
REQUIRE_PREDICATE GAME_IS "bg2ee bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY ~ZSTweaks/eff/ZSTWWED6.EFF~ ~override~

COPY_EXISTING "dagg09.ITM" ~override~
    SAY IDENTIFIED_DESC @6570
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            match_opcode = 177
            check_headers = 1
        STR_VAR
            resource = ~ZSTWWED6~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1680 DESIGNATED 1680 GROUP @12 // STILETTO TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_stiletto.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1681 DESIGNATED 1681 GROUP @12 // ELEMENTS' FURY TWEAK
REQUIRE_PREDICATE GAME_IS "bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~bddagg01.itm~ ~override~
    SAY IDENTIFIED_DESC @6930
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            parameter1 = 2
    END
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 10 STR_VAR effects = ~op=27;op=28;op=29;op=30~ END
BUT_ONLY

COPY_EXISTING_REGEXP ~bddagg1[A-D]\.EFF~ ~override~
    WRITE_LONG 0x38 2
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1682 DESIGNATED 1682 GROUP @12 // ACID ETCHED DAGGER TWEAK
REQUIRE_PREDICATE GAME_IS "bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~bddagg05.itm~ ~override~
    SAY NAME2 @6940
    SAY IDENTIFIED_DESC @6941
    WRITE_LONG 0x60 3 // ench
    PATCH_IF MOD_IS_INSTALLED ~ZSTweaks.tp2~ ~1440~ BEGIN
        LPF ALTER_ITEM_HEADER
            INT_VAR
                header_type = 1
                damage_bonus = 3
                thac0_bonus = 4
        END
    END ELSE BEGIN
        LPF ALTER_ITEM_HEADER
            INT_VAR
                header_type = 1
                damage_bonus = 3
                thac0_bonus = 3
        END
    END
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            parameter1 = 0
            dicenumber = 1
            dicesize = 3
    END
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 146
            probability1 = 19
    END
    PATCH_IF MOD_IS_INSTALLED ~ZSTweaks.tp2~ ~1450~ BEGIN
        LPF ALTER_EFFECT
            STR_VAR
                match_resource = ~ZSTWD2~
                resource = ~ZSTWD3~
        END
    END
BUT_ONLY

COPY_EXISTING ~bddagg05.spl~ ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            parameter1 = 0
            dicenumber = 1
            dicesize = 3
    END
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_target = 2
            def_duration = 18
            def_type = 1
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=0,p1=-2,ip=3~
    END
BUT_ONLY

////////////////// TWO-HANDED WEAPON TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1200 DESIGNATED 1200 GROUP @13 // IXIL'S SPIKE TWEAK REMOVE HASTE IMMUNITY
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPER12.ITM~ ~override~
    LPF remove_haste_immunity END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1201 DESIGNATED 1201 GROUP @13 // LILARCOR TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW2H14.ITM~ ~override~
    SAY IDENTIFIED_DESC @6800
    LPF ALTER_HEADER
        INT_VAR
            match_type = 1
            match_speed = 8
            speed = 7
    END
    LPF a7_auto_apply_spl_effect // 14782 confused str
        INT_VAR
            def_target = 2
            def_type = 1
            def_savetype = 1 // spell
            def_resist_dispel = 3
            def_probability1 = 24
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=128,dur=6;op=139,p1=14782,tmg=3~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1202 DESIGNATED 1202 GROUP @13 // WARBLADE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW2H14.ITM~ ~override~
    SAY NAME2 @6860
    SAY IDENTIFIED_DESC @6861
    LPF ALTER_HEADER
        INT_VAR
            match_damage = 4
            damage = 2
    END
    SET cold = (2 << 16)
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_target = 2
            def_type = 1
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=12,dsize=4,dnum=1,p2=%cold%~
    END
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 1073741824 p2 = 9 STR_VAR effects = ~op=177,res=ZSTWWARA;op=177,res=ZSTWWARB;op=177,res=ZSTWWARC;op=177,res=ZSTWWARD;op=177,res=ZSTWWARE~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1280 DESIGNATED 1280 GROUP @13 // CARSOMYR CHAOTIC EVIL TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_holyaveng_evil.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1290 DESIGNATED 1290 GROUP @13 // CARSOMYR DISPEL SAVE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_holyaveng_dispel.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1300 DESIGNATED 1300 GROUP @13 // SILVER SWORD TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" "This mod was written for BG2EE/EET only"
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW2H15.ITM~ ~override~
    WRITE_LONG 0x60 4
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1318 DESIGNATED 1318 GROUP @13 // FLAME OF THE NORTH EVIL TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW2H12.ITM~ ~override~
    PATCH_IF !(MOD_IS_INSTALLED "ZSTweaks.tp2" "1322") BEGIN
        SAY IDENTIFIED_DESC @6170
    END ELSE BEGIN
        SAY IDENTIFIED_DESC @6172
    END
    LPF itm_first_offset_effect
        RET offset_eff = offset
    END // opcode eff
    WRITE_LONG (offset_eff + 0x4) 3 // MASK_EVIL
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1322 DESIGNATED 1322 GROUP @13 // FLAME OF THE NORTH TROLL BONUS
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW2H12.ITM~ ~override~
   PATCH_IF !(MOD_IS_INSTALLED "ZSTweaks.tp2" "1318") BEGIN
        SAY IDENTIFIED_DESC @6171
    END ELSE BEGIN
        SAY IDENTIFIED_DESC @6172
    END
    LPF a7_auto_apply_spl_effect
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~t=1,tgt=2,tmg=1,op=177,p1=129,p2=4,res=ZSTWTRL0~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1390 DESIGNATED 1390 GROUP @13 // STAFF OF THE MAGI DISPEL SAVE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~STAF11.ITM~ ~override~
    SAY IDENTIFIED_DESC @6400
    LPF itm_first_offset_effect
        RET offset_eff = offset
    END

    SET eff_number = SHORT_AT((LONG_AT 0x64) + 0x1e)
    FOR ( eff = 0; eff < eff_number; ++eff ) BEGIN
        WRITE_LONG (offset_eff + 0x24) 1 // save vs spell allowed
        WRITE_LONG (offset_eff + 0x28) "-2" // at
        offset_eff += 0x30
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1410 DESIGNATED 1410 GROUP @13 // UNHOLY REAVER DISPEL TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" "This mod was written for BG2EE/EET"
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_ohreaver_dispel.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1420 DESIGNATED 1420 GROUP @13 // UNHOLY REAVER DMG TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" "This mod was written for BG2EE/EET"
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_ohreaver_dmg.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1460 DESIGNATED 1460 GROUP @13 // SPEAR OF WITHERING
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "SPER10.ITM" ~override~
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_type = 1
            def_target = 2
            def_resist_dispel = 2
            def_duration = 6
            def_savebonus = "-2"
            def_savetype = 4
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=25,p1=2,p2=2;op=142,p2=6~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1540 DESIGNATED 1540 GROUP @13 // WAVE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY ~ZSTweaks/eff/ZSTWWAVE.EFF~ ~override~

COPY_EXISTING "HALB09.ITM" ~override~
    SAY IDENTIFIED_DESC @6420
    SET cold = (2 << 16)
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_type = 1
            def_target = 2
            def_timing = 9
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=12,p1=3,p2=%cold%;op=177,p1=142,p2=4,res=ZSTWWAVE~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1590 DESIGNATED 1590 GROUP @13 // BLACKMIST TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "HALB06.ITM" ~override~
    SAY IDENTIFIED_DESC @6550
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_headers = 1
            header_type = 3
            savebonus = "-2"
    END
    SET blinded_strref1 = 14674
    SET blinded_strref2 = 1474
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=101,p2=74;op=169,p2=8;op=267,p1=%blinded_strref1%;op=267,p1=%blinded_strref2%~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1591 DESIGNATED 1591 GROUP @13 // SOUL REAVER THAC0 TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "SW2H08.ITM" ~override~
    PATCH_IF !(MOD_IS_INSTALLED "ZSTweaks.tp2" "1592") BEGIN
        SAY IDENTIFIED_DESC @6830
    END ELSE BEGIN
        SAY IDENTIFIED_DESC @6850
    END
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 54
            match_duration = 120
            duration = 30
            savingthrow = 1 // spell
            savebonus = "-4"
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1592 DESIGNATED 1592 GROUP @13 // SOUL REAVER DICESIZE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "SW2H08.ITM" ~override~
    PATCH_IF !(MOD_IS_INSTALLED "ZSTweaks.tp2" "1591") BEGIN
        SAY IDENTIFIED_DESC @6840
    END ELSE BEGIN
        SAY IDENTIFIED_DESC @6850
    END
    PATCH_IF !(MOD_IS_INSTALLED "ZSTweaks.tp2" "1430") BEGIN
        LPF ALTER_HEADER
            INT_VAR
                match_dicesize = 10
                dicesize = 12
        END
    END ELSE BEGIN
        LPF ALTER_HEADER
            INT_VAR
                match_dicesize = 9
                match_damage = 5
                dicesize = 6
                dicenumber = 2
                damage = 4
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1593 DESIGNATED 1593 GROUP @13 // SWORD OF RUIN +2 TWEAK
REQUIRE_PREDICATE GAME_IS "bgee eet" @50
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~bdsw2h03.ITM~ ~override~
   SAY IDENTIFIED_DESC @6900
BUT_ONLY

COPY_EXISTING ~bdsw2h03.spl~ ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            match_dicesize = 4
            match_parameter1 = 0
            dicesize = 5
            parameter1 = 2
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1594 DESIGNATED 1594 GROUP @13 // STAFF OF THE CLERIC +2 TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee" @50
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY
    ~ZSTweaks/eff/ZSTWSF01.eff~ ~override~
    ~ZSTweaks/eff/ZSTWSF02.eff~ ~override~
    ~ZSTweaks/eff/ZSTWSF03.eff~ ~override~

COPY_EXISTING ~STAF19.ITM~ ~override~
    SAY IDENTIFIED_DESC @7060
    LPF ADD_ITEM_HEADER INT_VAR target = 5 charges = 2 depletion = 3 flags = 2**9 + 2**11
        STR_VAR
            icon = ~SPPR514B~
    END
    LPF a7_auto_apply_spl_effect STR_VAR function_name = "ADD_ITEM_EFFECT" effect_codes = ~op=146,tgt=1,t=3,p1=1,tmg=1,res=SPPR514~ END
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 204 p2 = 5 STR_VAR effects = ~op=0,p1=1,p2=0;op=177,res=ZSTWSF01;op=177,res=ZSTWSF02;op=177,res=ZSTWSF03~ END
BUT_ONLY

////////////////// ONE-HANDED SWORD TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\
//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1125 DESIGNATED 1125 GROUP @14 // NINJATO SCARLET BROTHERHOOD
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "WANINJA.itm" ~override~
    WRITE_LONG 0x1e 1074057600 // usability opened
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1126 DESIGNATED 1126 GROUP @14 // BLACKRAZOR
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "MISCBC.itm" ~override~
    SAY IDENTIFIED_DESC @6810
    WRITE_LONG 0x60 4
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1127 DESIGNATED 1127 GROUP @14 // PERIDAN TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "SW1H32.itm" ~override~
    SAY IDENTIFIED_DESC @6870
    LPF ALTER_EFFECT
        INT_VAR
            check_headers = 0
            match_opcode = 98
            parameter1 = 18
    END
    LPF ALTER_HEADER INT_VAR match_type = 3 charges = 3 END
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 146 p2=4 STR_VAR effects = ~op=178,spc=4;op=219~ END
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 15 STR_VAR effects = ~op=27;op=28;op=29;op=30~ END
BUT_ONLY

COPY_EXISTING "SW1H32C.EFF" ~override~
    WRITE_LONG 0x38 2
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1210 DESIGNATED 1210 GROUP @14 // EQUALIZER TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW1H54.ITM~ ~override~
    SAY IDENTIFIED_DESC @6060
    WRITE_LONG 0x60 5
    LPF ALTER_HEADER
        INT_VAR
            damage = 3
            speed = 2
            to_hit = 3
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1220 DESIGNATED 1220 GROUP @14 // RAS TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_ras.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1230 DESIGNATED 1230 GROUP @14 // SWORD OF MASK TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_swmask.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1240 DESIGNATED 1240 GROUP @14 // PURIFIER EVIL TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW1H64.ITM~ ~override~
    SAY IDENTIFIED_DESC @6090

    LPF itm_first_offset_effect
        RET offset_eff = offset
    END
    WRITE_LONG (offset_eff + 0x4) 3 // MASK_EVIL
BUT_ONLY

 COPY_EXISTING ~SW1H65.ITM~ ~override~
   SAY IDENTIFIED_DESC @6091

    LPF itm_first_offset_effect
        RET offset_eff = offset
    END
    WRITE_LONG (offset_eff + 0x4) 3 // MASK_EVIL
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1241 DESIGNATED 1241 GROUP @14 // PURIFIER DISPEL MAGIC TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW1H65.ITM~ ~override~
    LPF ALTER_EFFECT
        INT_VAR
            header_type = 3
            header = 2
            match_opcode = 146
            parameter1 = 30
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1250 DESIGNATED 1250 GROUP @14 // YAMATO TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW1H66.ITM~ ~override~
    SAY IDENTIFIED_DESC @6110
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_globals = 1
            match_opcode = 0
            parameter1 = 2
    END
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 5 STR_VAR effects = ~op=0,p1=1,p2=14;op=27;op=28;op=29;op=30;op=31;op=86;op=87;op=88;op=89;op=166;op=173~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1260 DESIGNATED 1260 GROUP @14 // USUNO BLADE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SW1H67.ITM~ ~override~
    SAY IDENTIFIED_DESC @6120
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_headers = 1
            match_opcode = 12
            dicesize = 4
            dicenumber = 5
            parameter1 = 1
            savebonus = "-2"
    END
    LPF ADD_EQUIPPED_EFF INT_VAR p1 = 40 STR_VAR effects = ~op=29~ END
    SET electricity = (4 << 16)
    LPF a7_auto_apply_spl_effect
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~t=1,op=12,tgt=2,tmg=9,p2=%electricity%,dsize=3,dnum=1~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1270 DESIGNATED 1270 GROUP @14 // SPECTRAL BRAND TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_spectral_brand.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1315 DESIGNATED 1315 GROUP @14 // DAKKON KATANA TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_dakkon.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1319 DESIGNATED 1319 GROUP @14 // HOLY SWORD OF TYR TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~OHDHSWD.ITM~ ~override~
    SAY IDENTIFIED_DESC @6190
    LPF itm_first_offset_effect
        RET offset_eff = offset
    END // opcode eff
    WRITE_LONG (offset_eff + 0x4) 3 // MASK_EVIL
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1341 DESIGNATED 1341 GROUP @14 // HINDOS DOOM TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_hindosdoom.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1470 DESIGNATED 1470 GROUP @14 // ADJATHA THE DRINKER TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_swdrinker.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1550 DESIGNATED 1550 GROUP @14 // DRIZZTS WEAPONS TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_drizzt_wpns.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1580 DESIGNATED 1580 GROUP @14 // HAWKSIGHT TWEAK 1
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "ohrsw1h1.itm" ~override~
    SAY IDENTIFIED_DESC @6541
    LPF ALTER_HEADER
        INT_VAR
            match_type = 1
            to_hit = 4
    END
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=325,p1=1;op=1,p1=6~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1581 DESIGNATED 1581 GROUP @14 // HAWKSIGHT TWEAK 2
REQUIRE_COMPONENT "ZSTweaks.tp2" "1580" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "ohrsw1h1.itm" ~override~
    SAY IDENTIFIED_DESC @6540
    LPF ADD_ITEM_HEADER
        INT_VAR
            type = 3
            location = 3
            target = 5
            charges = 1
            depletion = 3
            flags = 2**11
        STR_VAR
            icon = ~SPWI208C~
    END
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_type = 3
            def_parameter1 = 10
            def_parameter2 = 2
            def_timing = 9
            def_target = 1
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=146,res=SPWI203;op=146,res=SPWI202~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1582 DESIGNATED 1582 GROUP @14 // VEXATION TWEAK
REQUIRE_PREDICATE GAME_IS "bgee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "bdsw1h21.itm" ~override~
    SAY NAME2 @6980
    SAY IDENTIFIED_DESC @6981
    WRITE_LONG 0x60 3
    LPF ALTER_HEADER
        INT_VAR
            match_speed = 1
            match_damage = 2
            match_to_hit = 2
            speed = 0
            damage = 3
            to_hit = 3
    END
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=341,res=ZSTWVEX0~ END
BUT_ONLY

COPY_EXISTING "bdsw1h21.spl" ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_parameter1 = 1
            dicesize = 2
            dicenumber = 1
    END
BUT_ONLY

////////////////// MACES/CLUBS \\\\\\\\\\\\\\\\\\\\\\\\\\

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1310 DESIGNATED 1310 GROUP @15 // FLAIL EASTHAVEN TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~WAFLAIL.ITM~ ~override~
    SAY IDENTIFIED_DESC @6130
    FOR ( opcode = 86; opcode <= 88; ++opcode ) BEGIN
        LPF ALTER_ITEM_EFFECT
            INT_VAR
                check_globals = 1
                match_opcode = opcode
                parameter1 = 10
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1311 DESIGNATED 1311 GROUP @15 // KROTAN MACE TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY ~ZSTweaks/eff/ZSTWBL01.EFF~ ~override~

COPY_EXISTING ~BLUN11.ITM~ ~override~
    SAY IDENTIFIED_DESC @6150
    LPF a7_auto_apply_spl_effect
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~t=1,op=177,tgt=2,p1=1,p2=3,tmg=1,rd=2,res=ZSTWBL01~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1312 DESIGNATED 1312 GROUP @15 // SKULLCRUSHER TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY ~ZSTweaks/eff/ZSTWBL02.EFF~ ~override~

COPY_EXISTING ~BLUN18.ITM~ ~override~
    SAY IDENTIFIED_DESC @6160
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_headers = 1
            match_opcode = 177
        STR_VAR
            resource = ~ZSTWBL02~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1313 DESIGNATED 1313 GROUP @15 // GNASHER TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY ~ZSTweaks/spl/other/ZSTWPAIN.SPL~ ~override~

COPY_EXISTING ~BLUN24.ITM~ ~override~
    SAY IDENTIFIED_DESC @6182
    LPF a7_auto_apply_spl_effect
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~t=1,tgt=2,op=146,res=ZSTWPAIN,p2=1,tmg=1,rd=2~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1314 DESIGNATED 1314 GROUP @15 // MACE OF JERROD TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~WAMACE.ITM~ ~override~
    WRITE_LONG 0x60 3
    SAY NAME2 @6350
    SAY IDENTIFIED_DESC @6351
    LPF ALTER_HEADER
        INT_VAR
            match_damage = 3
            match_to_hit = 2
            match_speed = 5
            to_hit = 3
            speed = 4
            damage = 4
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1320 DESIGNATED 1320 GROUP @15 // FLAIL OF AGES TWEAK REMOVE HASTE IMMUNITY
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~BLUN30.ITM~ ~override~
    LPF remove_haste_immunity END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1321 DESIGNATED 1321 GROUP @15 // BONE CLUB UNDEAD TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_boneclub.tph~

////////////////// RANGED WEAPON TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\
//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1010 DESIGNATED 1010 GROUP @16 // ASP NEST TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "DART05.itm" ~override~
    SAY IDENTIFIED_DESC @6390
    LPF ALTER_EFFECT
        INT_VAR
            check_headers = 1
            header_type = 2
            match_opcode = 25
            savebonus = "-4"
    END
    LPF ALTER_EFFECT
        INT_VAR
            check_headers = 1
            header_type = 2
            match_opcode = 142
            savebonus = "-4"
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1330 DESIGNATED 1330 GROUP @16 // DARKFIRE BOW TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_darkfire.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1340 DESIGNATED 1340 GROUP @16 // TARALASH TWEAKS
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_taralash.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1342 DESIGNATED 1342 GROUP @16 // PROTECTOR OF THE DRYADS TWEAKS
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY ~ZSTweaks/eff/ZSTWMI01.EFF~ ~override~

COPY_EXISTING ~BOW08.ITM~ ~override~
    PATCH_IF GAME_IS "bgee" BEGIN
        SAY IDENTIFIED_DESC @7010
    END
    PATCH_IF GAME_IS "bg2ee" BEGIN
        SAY IDENTIFIED_DESC @7020
    END
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_timing = 1
            def_target = 2
            def_parameter2 = 4
            def_type = 4
        STR_VAR
            def_resource = ~ZSTWMI01~
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=177,p1=113;op=177,p1=143;op=177,p1=165;op=177,p1=110;op=177,p1=161;op=177,p1=111~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1343 DESIGNATED 1343 GROUP @16 // MANA BOW TWEAKS
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~BOW13.ITM~ ~override~
    SAY IDENTIFIED_DESC @7070
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=166,p1=5;op=142,p2=63~ END
    LPF ALTER_EFFECT INT_VAR match_opcode = 31 match_paremeter1 = 20 parameter1 = 33 END
    SET magic = (64 << 16)
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_type = 4
            def_target = 2
            def_savetype = 1
            def_savebonus = "-2"
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=12,p1=1,tmg=1,p2=%magic%,dsize=4,dnum=1;op=60,p1=10,dur=24~
    END
BUT_ONLY

////////////////// NPC GEAR TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\
//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1380 DESIGNATED 1380 GROUP @17 // HAERDALIS BLADES WEAPONS
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_haerdalis_wpn.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1480 DESIGNATED 1480 GROUP @17 // YOSHIMO KATANA TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "NPSW02.ITM" ~override~
    SAY IDENTIFIED_DESC @6270
    LPF ALTER_HEADER
        INT_VAR
            type = 1
            match_speed = 3
            speed = 1
    END
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=301,p1=2,p2=1;op=233,p1=2,p2=94~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1500 DESIGNATED 1500 GROUP @17 // MAZZY WEAPON TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_mazzy_gear.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1510 DESIGNATED 1510 GROUP @17 // ANOMEN SHIELD
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "NPSHLD.ITM" ~override~
    SAY IDENTIFIED_DESC @6250
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_globals = 1
            match_opcode = 0
            parameter1 = 3
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1520 DESIGNATED 1520 GROUP @17 // KELDORN SWORD TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "NPSW03.ITM" ~override~
    SAY IDENTIFIED_DESC @6230
    WRITE_LONG 0x60 3
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1640 DESIGNATED 1640 GROUP @17 // DORN BLADES
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP "ohdsw2h[a-d].ITM" ~override~
    WRITE_LONG 0x60 5
    PATCH_IF "%SOURCE_RES%" STRING_COMPARE_CASE "ohdsw2ha" = 0 BEGIN
        SAY IDENTIFIED_DESC @6660
    END
    PATCH_IF "%SOURCE_RES%" STRING_COMPARE_CASE "ohdsw2hb" = 0 BEGIN
        SAY IDENTIFIED_DESC @6670
    END
    PATCH_IF "%SOURCE_RES%" STRING_COMPARE_CASE "ohdsw2hc" = 0 BEGIN
        SAY IDENTIFIED_DESC @6680
    END
    PATCH_IF "%SOURCE_RES%" STRING_COMPARE_CASE "ohdsw2hd" = 0 BEGIN
        SAY IDENTIFIED_DESC @6690
    END
BUT_ONLY

COPY_EXISTING_REGEXP "ohdsw2h[bc].ITM" ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            parameter1 = 1
    END
BUT_ONLY

COPY_EXISTING "ohdsw2hd.ITM" ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            parameter1 = 2
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1641 DESIGNATED 1641 GROUP @17 // ITEM CREATION BY VANILLA NPC
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

ACTION_IF FILE_EXISTS_IN_GAME ~SPIN829.SPL~ BEGIN
    COPY_EXISTING ~SPIN829.SPL~ ~override~
        LPF ALTER_EFFECT
            INT_VAR
                match_opcode = 122
                match_parameter1 = 5
                parameter1 = 10
        END
    BUT_ONLY
END

ACTION_IF FILE_EXISTS_IN_GAME ~SPIN116.SPL~ BEGIN
    COPY_EXISTING ~SPIN116.SPL~ ~override~
        LPF ALTER_EFFECT
            INT_VAR
                match_opcode = 122
                match_parameter1 = 5
                parameter1 = 15
        END
    BUT_ONLY
END

ACTION_IF FILE_EXISTS_IN_GAME ~AROW14.ITM~ BEGIN
    COPY_EXISTING ~AROW14.ITM~ ~override~
        LPF ALTER_EFFECT
            INT_VAR
                match_opcode = 25
                match_parameter1 = 3
                parameter1 = 2
        END
    BUT_ONLY
END

////////////////// MISC ITEMS TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1190 DESIGNATED 1190 GROUP @18 // ROD OF MIGHT TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_rod_might.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1600 DESIGNATED 1600 GROUP @18 // CHARNAME TANKARD TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "ohntank.ITM" ~override~
    SAY UNIDENTIFIED_DESC @6450
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_headers = 1
            header_type = 3
            match_opcode = 17
            dicesize = 0
            dicenumber = 0
            parameter1 = 27
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @1601 DESIGNATED 1601 GROUP @18 // POTION PREVENT STACKING
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
    READ_SHORT 0x1c category_itm
    PATCH_IF category_itm = 9 OR category_itm = 13 BEGIN// if it's a potion or food item
        PATCH_IF "%SOURCE_RES%" STRING_COMPARE_CASE "GBERRY" = 0 BEGIN
            LPF a7_auto_apply_spl_effect
            STR_VAR
                function_name = ~ADD_ITEM_EFFECT~
                effect_codes  = ~op=321,tgt=1,res=%SOURCE_RES%,ip=0~ // prevent stacking
            END
        END
        PATCH_IF (!MOD_IS_INSTALLED "ZSTweaks.tp2" "240") AND "%SOURCE_RES%" STRING_COMPARE_CASE "GBERRY" = 0 BEGIN
            LPF a7_auto_apply_spl_effect
            STR_VAR
                function_name = ~ADD_ITEM_EFFECT~
                effect_codes  = ~op=321,tgt=1,res=%SOURCE_RES%,ip=0~ // prevent stacking
            END
        END
    END
BUT_ONLY

////////////////// WIZARD SPELL TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\

//////////////////////////////////////////////////////////////////////////////////////////////////////
 BEGIN @140 DESIGNATED 140 GROUP @19
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_fdeath_std.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @145 DESIGNATED 145 GROUP @19 // LUCK DURATION BOOST
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI209.SPL~ ~override~
    PATCH_IF !(MOD_IS_INSTALLED "ZSTweaks.tp2" "147") BEGIN
        SAY UNIDENTIFIED_DESC @6710
    END ELSE BEGIN
        SAY UNIDENTIFIED_DESC @6730
    END
    LPF ALTER_EFFECT
        INT_VAR
            check_globals = 0
            match_duration = 18
            duration = 60
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @147 DESIGNATED 147 GROUP @19 // LUCK OVERALL BOOST
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_luckboost.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
//BEGIN @150 DESIGNATED 150 GROUP @19 // DISINTEGRATE TWEAK
//REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @160 DESIGNATED 160 GROUP @19 // BLAKBLAD NO BACKSTAB TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~BLAKBLAD.ITM~ ~override~
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=263,p1=0,p2=1~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @163 DESIGNATED 163 GROUP @19 // GOLIRO NO BACKSTAB TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~CDGOLIRO.ITM~ ~override~
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=263,p1=0,p2=1~ END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @161 DESIGNATED 161 GROUP @19 // PHANBLAD DUR STD
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI518.SPL~ ~override~
    SET dur = 126
    SET new_header = (SHORT_AT 0x68) + 1
    FOR ( level = 19; level <= 20; ++level ) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = new_header - 1
                zs_min_level_for_copy = level
        END
        LPF ALTER_EFFECT
            INT_VAR
                header_type = 1
                header = new_header - 1
                match_duration = dur
                duration = dur + 6
        END
        ++new_header
        dur += 6
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @170 DESIGNATED 170 GROUP @19 // WAIL OF BANSHEE MAGIC DMG TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI913.SPL~ ~override~
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_target = 2  // Preset target
            def_power = 9
        STR_VAR
            function_name = ~ADD_SPELL_EFFECT~
            effect_codes  = ~op=12,p1=3,tmg=1,dr=1,dnum=3,dsize=6,p2=0;op=80,tmg=0,rd=2,dur=12~
    END
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            parameter2 = (64 << 16)
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @180 DESIGNATED 180 GROUP @19 // METEORM SWARM TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_meteorswarm.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
//BEGIN @200 DESIGNATED 200 GROUP @19 SLEEP TWEAK
/////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @210 DESIGNATED 210 GROUP @19 // HORROR ENCHANTMENT TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI205.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5050
    WRITE_ASCII 0x10 ~CAS_M05~ #8
    WRITE_BYTE 0x22 11
    WRITE_BYTE 0x25 4
    WRITE_SHORT 0x1e (2**11) // this wipes out the whole bitfield and sets it to 2048 (evocation)
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @220 DESIGNATED 220 GROUP @19 // ICE STORM TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI404.SPL~ ~override~
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            dicenumber = 3
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @370 DESIGNATED 370 GROUP @19 // RAY OF ENFEEBLEMENT NECROMANCY
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI221.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5220
    WRITE_ASCII 0x10 ~CAS_M07~ #8
    WRITE_BYTE 0x22 9
    WRITE_BYTE 0x25 7
    WRITE_SHORT 0x1e (2**10) // this wipes out the whole bitfield and sets it to illusion
    READ_SHORT 0x68 num_abilities
    FOR (i = 1; i <= num_abilities; i += 1) BEGIN
        LPF ALTER_SPELL_HEADER
            INT_VAR
                projectile = 50 // necromancy projectile
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @380 DESIGNATED 380 GROUP @19 // CONTAGION TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI409.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5240
    LPF DELETE_EFFECT
        INT_VAR
            match_opcode = 78
            match_parameter2 = 9
    END
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 78
            match_parameter2 = 4
            parameter1 = 4
    END
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 78
            match_parameter2 = 5
            parameter1 = 4
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @390 DESIGNATED 390 GROUP @19 // DEATH FOG TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI614.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5230
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            match_opcode = 12
            dicesize = 4
            dicenumber = 4
            parameter1 = 0
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @400 DESIGNATED 400 GROUP @19 // ENERGY DRAIN TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI914.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5250
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            match_opcode = 216
            parameter1 = 6
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @405 DESIGNATED 405 GROUP @19 // MAZE MR TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI813.SPL~ ~override~
    LPF ALTER_EFFECT
        INT_VAR
            check_globals = 0
            match_resist_dispel = 1
            resist_dispel = 3
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @407 DESIGNATED 407 GROUP @19 // FAMILIAR BGEE TWEAK
REQUIRE_PREDICATE GAME_IS "bgee" @49 // familiars are handled differently in EET, thus only available for BGEE
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~FAMIMP.CRE~ ~override~
    READ_SHORT 0x26 max_health
    PATCH_IF max_health < 12 BEGIN
        WRITE_SHORT 0x24 12
        WRITE_SHORT 0x26 12
    END
BUT_ONLY

COPY_EXISTING ~SPWI123.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @6650
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @410 DESIGNATED 410 GROUP @19 // HORRID WILTING TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
//////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_horridwilting.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @430 DESIGNATED 430 GROUP @19 // GREASE TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
//////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_grease.tph~

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @440 DESIGNATED 440 GROUP @19 // COMET TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
//////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_comet.tph~

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @441 DESIGNATED 441 GROUP @19 // TENSER THAC0 tweak
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI603.SPL~ ~override~
    LPF ADD_SPELL_HEADER
        INT_VAR
            copy_header = 8
            zs_min_level_for_copy = 21
    END
    LPF ALTER_EFFECT
        INT_VAR
            header = 9
            multi_match = 1
            match_opcode = 54
            parameter1 = 0
    END
BUT_ONLY

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @442 DESIGNATED 442 GROUP @19 // TENSER APR tweak
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI603.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5130
    SET dur = 72
    LPF ADD_SPELL_EFFECT
        INT_VAR
            opcode = 1
            header = 1
            duration = dur
            power = 6
            target = 1
            resist_dispel = 3
            parameter1 = 6
    END
    dur = 78
    READ_SHORT 0x68 num_abilities
    FOR (i = 2; i <= num_abilities; i += 1) BEGIN
        LPF ADD_SPELL_EFFECT
            INT_VAR
                opcode = 1
                header = i
                duration = dur
                power = 6
                target = 1
                resist_dispel = 3
                parameter1 = 1
            END
        dur += 6
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @443 DESIGNATED 443 GROUP @19 // SYMBOL OF DEATH BOOST
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
FORBID_COMPONENT "ZSTweaks.tp2" "340" @55
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_symbol_death.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @444 DESIGNATED 444 GROUP @19 // FLESH TO STONE PETRIFICATION SAVES
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPWI604.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @6950
    LPF ALTER_EFFECT
        INT_VAR
            match_savingthrow = 1
            savingthrow = 16
    END
BUT_ONLY

COPY_EXISTING ~SPIN984.SPL~ ~override~ // beholder version
    LPF ALTER_EFFECT
        INT_VAR
            match_savingthrow = 1
            savingthrow = 16
    END
BUT_ONLY

////////////////// CLERIC/DRUID SPELL TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @100 DESIGNATED 100 GROUP @20 // GLYPH OF WARDING HALF ON SAVE
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR304.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5000
    SAY DESC @5000
    LPF ALTER_EFFECT
        INT_VAR
            match_savingthrow = 2**0 + 2**24
            special = 256
    END
    SET new_header = (SHORT_AT 0x68) + 1
    FOR ( level = 19; level <= 20; ++level ) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = new_header - 1
                zs_min_level_for_copy = level
        END
        LPF ALTER_SPELL_EFFECT
            INT_VAR
                header = new_header
                match_opcode = 12
                dicenumber = level
        END
        ++new_header
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @101 DESIGNATED 101 GROUP @20 // FBLADE UNDEAD BONUS
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY ~ZSTweaks/eff/ZSTWFL04.EFF~ ~override~

COPY_EXISTING ~SPPR206.SPL~ ~override~
    PATCH_IF MOD_IS_INSTALLED "ZSTweaks.tp2" "102" BEGIN
        SAY UNIDENTIFIED_DESC @6630
    END ELSE BEGIN
        SAY UNIDENTIFIED_DESC @6610
    END
BUT_ONLY

COPY_EXISTING ~FBLADE.ITM~ ~override~
    WRITE_LONG 0x18 (THIS + 2**6) // magical, destructive
    LPF ADD_EQUIPPED_EFF STR_VAR effects = ~op=344,p1=4,p2=3,spc=2~ END
    PATCH_IF NOT GAME_IS "iwdee" BEGIN
        LPF a7_auto_apply_spl_effect
            STR_VAR
                function_name = ~ADD_ITEM_EFFECT~
                effect_codes  = ~t=1,tgt=2,tmg=1,rd=2,op=177,res=ZSTWFL04,p1=3,p2=4~
        END
    END ELSE BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                check_globals = 0
                match_opcode = 177
            STR_VAR
                match_resource = ~FBLADE~
                resource = ~ZSTWFL04~
        END
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @102 DESIGNATED 102 GROUP @20 // FBLADE DURATION BOOST
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR206.SPL~ ~override~
    PATCH_IF MOD_IS_INSTALLED "ZSTweaks.tp2" "101" BEGIN
        SAY UNIDENTIFIED_DESC @6630
    END ELSE BEGIN
        SAY UNIDENTIFIED_DESC @6620
    END
    FOR ( level = 3; level <= 19; level += 2 ) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = 1
                zs_min_level_for_copy = level
                insert_point = level - 1
        END
    END
    READ_SHORT 0x68 num_abilities
    SET dur = 24
    FOR ( level = 0; level < 20; ++level ) BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                header = level
                duration = dur
        END
        dur += 6
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @110 DESIGNATED 110 GROUP @20 // BLESS SCALING DURATION BOOST
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR101.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5010
    SAY DESC @5010
    SET headers = 0
    FOR (i = 3; i <= 19; i += 2) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = 1
                zs_min_level_for_copy = i
        END
        headers += 1
    END
    SET dur = 42
    FOR (i = 1; i <= headers; i+=1) BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                header = i
                match_duration = 36
                duration = dur
        END
        dur += 6
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @130 DESIGNATED 130 GROUP @20 // HOLD PERSON STANDARDIZATION
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR208.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5020
    SAY DESC @5020
    LPF ALTER_EFFECT
        INT_VAR
            match_savingthrow = 1
            savebonus = "-1"
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @190 DESIGNATED 190 GROUP @20 // HOLY POWER THAC0 TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR412.SPL~ ~override~
    LPF ADD_SPELL_HEADER
        INT_VAR
            copy_header = 13
            zs_min_level_for_copy = 21
    END
    LPF ALTER_EFFECT
        INT_VAR
            header = 14
            match_opcode = 54
            parameter1 = 0
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @230 DESIGNATED 230 GROUP @20 //CLOAK OF FEAR TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR416.SPL~ ~override~
    READ_LONG 0x08 cloak_fear_strref
BUT_ONLY

COPY ~ZSTweaks/spl/iwd~ ~override~

COPY_EXISTING ~SPPR416.SPL~ ~override~
    WRITE_LONG 0x08 cloak_fear_strref
    SAY UNIDENTIFIED_DESC @6640
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 215
        STR_VAR
            resource = ~ICCLKFR2~
    END
BUT_ONLY

COPY_EXISTING ~#COFEAR.SPL~ ~override~
    PATCH_IF GAME_IS ~bgee~ BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                match_opcode = 139
                parameter1 = 25818
        END
    END
    PATCH_IF GAME_IS ~bg2ee eet~ BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                match_opcode = 139
                parameter1 = 14007
        END
    END
BUT_ONLY

// ADD EFFECT REMOVAL TO AURA EFFECTS TO VARIOUS REMOVE-FEAR TYPE EFFECTS only affects spells for now
COPY_EXISTING_REGEXP ~.*\.spl~ ~override~
    LPF CLONE_EFFECT
        INT_VAR
            silent = 1
            match_opcode = 321
        STR_VAR
            match_resource = ~SPPR416~
            resource = ~#COFEAR~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @240 DESIGNATED 240 GROUP @20 // GOODBERRY TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_gberry.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @250 DESIGNATED 250 GROUP @20 // EARTHQUAKE PARTY FRIENDLY
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR720.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5090
    LPF ALTER_SPELL_HEADER
        INT_VAR
            projectile = 159
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @350 DESIGNATED 350 GROUP @20 // EARTHQUAKE NO SHAKE
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" "This mod was written for BGEE and BG2EE"
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR720.SPL~ ~override~
    LPF DELETE_SPELL_EFFECT
        INT_VAR opcode_to_delete = 269
    END
    LPF DELETE_EFFECT
        STR_VAR match_resource = ~SHAKE1~
    END
BUT_ONLY

ACTION_IF !GAME_IS "bgee" BEGIN
    COPY_EXISTING ~SPOGRE01.SPL~ ~override~
        LPF DELETE_SPELL_EFFECT
            INT_VAR opcode_to_delete = 269
        END
        LPF DELETE_EFFECT
            STR_VAR match_resource = ~SHAKE1~
        END
    BUT_ONLY
END

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @260 DESIGNATED 260 GROUP @20 // NEGATIVE PLANE DUR BOOST
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR413.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5080
    SAY DESC @5080
    SET headers = 0
    FOR (i = 9; i <= 19; i += 2) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = 1
                zs_min_level_for_copy = i
        END
        headers += 1
    END
    SET dur = 36
    FOR (i = 1; i <= headers; i += 1) BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                header = i
                match_duration = 30
                duration = dur
        END
        dur += 6
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @270 DESIGNATED 270 GROUP @20 // ENTANGLE TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR105.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5100
    LPF ALTER_EFFECT
        INT_VAR
            savebonus = 2
    END
    SET headers = 0
    FOR (i = 5; i <= 20; i += 5) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = 1
                zs_min_level_for_copy = i
        END
        headers += 1
    END
    SET bonus = 1
    FOR (i = 1; i <= headers; i += 1) BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                header = i
                savebonus = bonus
        END
        bonus -= 1
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @280 DESIGNATED 280 GROUP @20 // CLERIC POISON TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR411.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5110
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 12
            special = 256
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @290 DESIGNATED 290 GROUP @20 // HOLY POWER APR TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR412.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5120
    SET dur = 42
    FOR (i = 1; i <= 6; i += 1) BEGIN
        LPF ADD_SPELL_EFFECT
            INT_VAR
                opcode = 1
                header = i
                duration = dur
                power = 4
                target = 1
                resist_dispel = 3
                parameter1 = 6
        END
        dur += 6
    END
    READ_SHORT 0x68 num_abilities
    FOR (i = 7; i <= num_abilities; i += 1) BEGIN
        LPF ADD_SPELL_EFFECT
            INT_VAR
                opcode = 1
                header = i
                duration = dur
                power = 4
                target = 1
                resist_dispel = 3
                parameter1 = 1
        END
        dur += 6
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @300 DESIGNATED 300 GROUP @20 // IRON SKINS SPEED BOOST
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR506.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5140
    LPF ALTER_SPELL_HEADER
        INT_VAR
            speed = 1
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @310 DESIGNATED 310 GROUP @20 // FIRESEEDS BOOST
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR606.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5150
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 122
            parameter1 = 12
    END
BUT_ONLY
COPY_EXISTING ~FIRESEED.ITM~ ~override~
    SAY UNIDENTIFIED_DESC @5160
    WRITE_BYTE 0x60 2
    LPF ALTER_ITEM_EFFECT
        INT_VAR
            check_headers = 1
            match_opcode = 12
            parameter1 = 5
            dicesize = 8
            dicenumber = 3
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @320 DESIGNATED 320 GROUP @20 // NATURE'S BEAUTY
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR704.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5170
    LPF ALTER_EFFECT
        INT_VAR
            match_opcode = 55
            savebonus = 1
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @330 DESIGNATED 330 GROUP @20 // CLERIC CONFUSION TWEAK
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR709.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5180
    LPF ALTER_EFFECT
        INT_VAR
            match_savebonus = "-2"
            savebonus = "-4"
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @340 DESIGNATED 340 GROUP @20 // SYMBOL OF DEATH TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
FORBID_COMPONENT "ZSTweaks.tp2" "443" @55
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_symbol_death.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @420 DESIGNATED 420 GROUP @20 // ARMOR OF FAITH
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR111.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @6200
    READ_SHORT 0x68 num_abilities
    SET start_dur = 24
    FOR ( i = 0; i < num_abilities; ++i ) BEGIN
        SET dur = start_dur + (i * 6)
        LPF ADD_SPELL_EFFECT
            INT_VAR
                header = i + 1
                target = 1
                opcode = 0
                parameter1 = 2
                power = 1
                duration = dur
                resist_dispel = 3
        END
    END
BUT_ONLY

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @450 DESIGNATED 450 GROUP @20 // BASIC HEALS TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bgee bg2ee eet" @54
//////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_basicheals.tph~

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @460 DESIGNATED 460 GROUP @20 // MASS CURE
REQUIRE_PREDICATE GAME_IS "bgee bg2ee eet" @53
//////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR514.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @6480
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            match_opcode = 17
            dicenumber = 4
            dicesize = 3
    END
    LPF ALTER_HEADER
        INT_VAR
            type = 1
            speed = 2
    END
BUT_ONLY

////////////////// CLASS AND KIT-RELATED TWEAKS \\\\\\\\\\\\\\\\\\\\\\\\\\

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2100 DESIGNATED 2100 GROUP @21 // SUN SOUL RAY TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bg2ee bgee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_sunsoulray.tph~

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2110 DESIGNATED 2110 GROUP @21 // SUN SOULDBEAM TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bg2ee bgee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "SPCL239a.eff" ~override~
    WRITE_LONG 0x1c 0 // damage
    WRITE_LONG 0x3c 6 // dice size
    WRITE_LONG 0x38 3 // dice number
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @360 DESIGNATED 360 GROUP @21 // ETHEREAL RETRIBUTION TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bg2ee bgee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR751.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @5210
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            match_opcode = 12
            dicesize = 6
            dicenumber = 6
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2111 DESIGNATED 2111 GROUP @21 // WRITHING FOG TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bg2ee bgee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR250.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @6680
    LPF ALTER_EFFECT
        INT_VAR
            check_globals = 0
            match_opcode = 12
            parameter1 = 1
    END
    LPF ALTER_EFFECT
        INT_VAR
            check_globals = 0
            match_savingthrow = 4 // death
            probability1 = 49
    END
    SET new_level = 4
    SET new_dicesize = 4
    FOR ( dice = 0; dice < 7; ++dice ) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = 1
                zs_min_level_for_copy = new_level
        END
        new_level += 2
        LPF ALTER_EFFECT
            INT_VAR
                match_opcode = 12
                dicesize = new_dicesize
        END
        ++new_dicesize
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2112 DESIGNATED 2112 GROUP @21 // SPIRIT FIRE TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bg2ee bgee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR450.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @7000
    READ_SHORT 0x68 abilities
    SET start_dmg = 7
    FOR ( curr_header = 0; curr_header < abilities; ++curr_header ) BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                check_globals = 0
                header_type = 1
                header = curr_header
                match_opcode = 12
                parameter1 = start_dmg
        END
        LPF ALTER_EFFECT
            INT_VAR
                check_globals = 0
                header_type = 1
                header = curr_header
                match_opcode = 146
                savingthrow = 0
                probability1 = 32
        END
        ++start_dmg
    END
    SET next_level = 11
    FOR ( extra_headers = 0; extra_headers < 2; ++extra_headers ) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = 1
                zs_min_level_for_copy = next_level
        END
        LPF ALTER_EFFECT
            INT_VAR
                check_globals = 0
                header_type = 1
                header = abilities
                dicenumber = next_level
                match_opcode = 12
                parameter1 = next_level
        END
        ++abilities
        ++next_level
    END
BUT_ONLY

COPY_EXISTING ~SPPR450B.SPL~ ~override~
    READ_SHORT 0x68 abilities
    SET start_dmg = 7
    FOR ( curr_header = 0; curr_header < abilities; ++curr_header ) BEGIN
        LPF ALTER_EFFECT
            INT_VAR
                check_globals = 0
                header_type = 1
                header = curr_header
                match_opcode = 12
                parameter1 = start_dmg
        END
        ++start_dmg
    END
    SET next_level = 11
    FOR ( extra_headers = 0; extra_headers < 2; ++extra_headers ) BEGIN
        LPF ADD_SPELL_HEADER
            INT_VAR
                copy_header = 1
                zs_min_level_for_copy = next_level
        END
        LPF ALTER_EFFECT
            INT_VAR
                check_globals = 0
                header_type = 1
                header = abilities
                match_opcode = 12
                parameter1 = next_level
        END
        ++abilities
        ++next_level
    END
BUT_ONLY


//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2113 DESIGNATED 2113 GROUP @21 // SPIRITUAL CLARITY TWEAK
REQUIRE_PREDICATE GAME_IS "iwdee bg2ee bgee eet" @54
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~SPPR350.SPL~ ~override~
    SAY UNIDENTIFIED_DESC @6990
    LPF ALTER_HEADER
        INT_VAR
            match_speed = 9
            speed = 6
    END
    LPF a7_auto_apply_spl_effect
        INT_VAR
            def_type = 1
            def_target = 2
            def_power = 3
        STR_VAR
            function_name = ~ADD_ITEM_EFFECT~
            effect_codes = ~op=164;op=4;op=240,p2=5;op=240,p2=4~
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2120 DESIGNATED 2120 GROUP @21 // WARCRY TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "SPCL908.SPL" ~override~
    SAY UNIDENTIFIED_DESC @6320
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            check_headers = 1
            savebonus = "-2"
            match_opcode = 142
    END
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            check_headers = 1
            savebonus = "-2"
            match_opcode = 24
    END
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            check_headers = 1
            savebonus = "-2"
            match_opcode = 141
    END
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            check_headers = 1
            savebonus = "-2"
            match_opcode = 174
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2130 DESIGNATED 2130 GROUP @21 // SPIKE TRAP TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "SPCL910B.SPL" ~override~
    SET piercing = (16 << 16)
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            header_type = 1
            check_headers = 1
            match_opcode = 12
            parameter2 = piercing
    END
BUT_ONLY

//////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2140 DESIGNATED 2140 GROUP @21 // EXPLODING TRAP TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING "SPCL911.SPL" ~override~
    SAY UNIDENTIFIED_DESC @6300
BUT_ONLY
COPY_EXISTING "SPCL911B.SPL" ~override~
    LPF ALTER_SPELL_EFFECT
        INT_VAR
            header_type = 1
            check_headers = 1
            match_opcode = 12
            dicenumber = 15
    END
BUT_ONLY

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2150 DESIGNATED 2150 GROUP @21 // NON BREACHABLE HLA TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee eet" @52
/////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING_REGEXP "SPCL90[47]\.SPL" ~override~
    WRITE_BYTE 0x27 0
BUT_ONLY

COPY_EXISTING_REGEXP "SPCL91[3467]\.SPL" ~override~
    WRITE_BYTE 0x27 0
BUT_ONLY

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2160 DESIGNATED 2160 GROUP @21 // QUIVERING PALM TWEAK
REQUIRE_PREDICATE GAME_IS "bg2ee bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_quivpalm.tph~

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2170 DESIGNATED 2170 GROUP @21 // THAC0 THIEF
REQUIRE_PREDICATE GAME_IS "bg2ee bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

LAF generate_rogue_thac0
    STR_VAR
        class1 = ~thief~
        class2 = ~mage_thief~
END

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2180 DESIGNATED 2180 GROUP @21 // THAC0 BARD
REQUIRE_PREDICATE GAME_IS "bg2ee bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

LAF generate_rogue_thac0
    STR_VAR
        class1 = ~bard~
END

/////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN @2190 DESIGNATED 2190 GROUP @21
REQUIRE_PREDICATE GAME_IS "bg2ee bgee eet" @53
/////////////////////////////////////////////////////////////////////////////////////////////////////

INCLUDE ~ZSTweaks/libs/component_scripts/zs_poisonwpn.tph~

/////////////////////////////////////////////////////////////////////////////////////////////////////
